---
title: "FinalProject1"
output: pdf_document
date: "`r Sys.Date()`"
---

```{r setup, message=FALSE, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# libraries
library(dplyr)
library(readxl)
library(sdcMicro)
?sdcMicro
```

### Loading in data from xlsx and formatting by creation of sdc object

```{r}
data <- read_excel("F/private_dataF.xlsx")
sdc <- createSdcObj(dat = data, keyVars = c("sex", "zip", "education", "citizenship", "marital_status", "party"))
```

### Generalisation and Suprresion - Top/Bottom coding to make age groups and broader regions??. K-anonimity as well!
```{r}
# generalizing `dob` by converting it to age groups
data$age <- as.numeric(format(Sys.Date(), "%Y")) - as.numeric(format(data$dob, "%Y"))
data$age <- cut(data$age, breaks = c(-Inf, 30, 50, 70, Inf), labels = c("Under 30", "30-50", "50-70", "70+"))

# generalizing `zip` into broader regions
# I dont think this one makes sense
data$zip_region <- ifelse(data$zip %in% c(2100, 2200), "Region 1", "Region 2")

# updating the `sdcMicro` object with the generalized data
sdc <- createSdcObj(dat = data, keyVars = c("sex", "zip_region", "education", "citizenship", "marital_status", "party"))

# applying k-anonymity
sdc <- kAnon(sdc, k = 5)
```

### applying PRAM now to add noise to categories like party and marital_status. Randomised response will also be used on party as it is more sensitive. Is this overkill??

```{r}
# applying PRAM on `party` and `marital_status`
sdc <- pram(sdc, variables = c("party", "marital_status"))
# adding some noise to sensitive variables
#sdc <- addNoise(sdc, noise = 0.3) #I cant get it to work.
```
### Microaggregation for numeric data

```{r}
# applying microaggregation on `evote`
sdc <- microaggregation(sdc, method = "mdav", variables = "evote") # I can't get it to work again
```
### Laplace Mechanism for Differential Privacy
```{r}
# applying Laplace noise to `evote` with an epsilon value for privacy
sdc <- addNoise(sdc, noise = "differential", epsilon = 1) # I can't get it to work again. Something with the length of some of sdc df
```
### Calculation of disclosure risks
```{r}
# Calculate and display disclosure risk
risk_value <- measure_risk(sdc)
print(risk_value)
```
```{r}
help(package = "sdcMicro")  # This will list available functions and their documentation
```

### Extracting the anonymized data now
```{r}
# Extract anonymized data
anonymized_data <- extractManipData(sdc)
anonymized_data
```




